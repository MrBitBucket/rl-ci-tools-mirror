#!/bin/bash
UNICODE_WIDTHS='16 32'
PYTHON_VERSIONS='2.7 3.3 3.4 3.5 3.6'
ARCHS='x86_64 i686'
IMAGESRC=quay.io/pypa
REPO=${REPO:-https://bitbucket.org/rptlab/reportlab}
REQUIREMENT=${REPO:-$(basename ${REPO})}
DOCKER_SCRIPT=${DOCKER_SCRIPT:-container-test-wheels}
DOCKER_PATH=${DOCKER_PATH:-/io/${DOCKER_SCRIPT}}
sudo rm -rf test-src
hg clone ${REPO} test-src
[ -n "$REVISION" ] && (cd test-src && hg up "$REVISION")
#IMAGESRC=rl
for arch in ${ARCHS}; do
	DOCKER_IMAGE=${IMAGESRC}/manylinux1_${arch}
	docker run --rm \
		${DOCKER_ARGS} \
		-e PYTHON_VERSIONS="$PYTHON_VERSIONS" \
		-e UNICODE_WIDTHS="$UNICODE_WIDTHS" \
		-e REPO="$REPO" \
		-e REQUIREMENT="$REQUIREMENT" \
		-e ARCH="$arch" \
		-v $(pwd):/io ${DOCKER_IMAGE} ${DOCKER_PATH}
done
sudo rm -rf reportlab-src test-env
